# 2050：最终审判 - 开发需求文档

## 项目概述

基于Ollama本地AI模型的多人辩论模拟游戏《2050：最终审判》，模拟人类社交互动，通过投票机制逐轮淘汰AI参与者，观察不同AI模型的行为模式和生存策略。

## 核心理念

- **角色扮演**：每个AI都被赋予人类身份，必须掩饰自己是AI的事实
- **社交博弈**：通过对话建立联盟、识别威胁、争取生存
- **投票淘汰**：每轮结束后进行民主投票，得票最多者被淘汰
- **行为观察**：研究不同AI模型在竞争环境下的策略差异

## 功能需求

### 1. 核心游戏机制

#### 1.1 游戏初始化
- **AI模型发现**：自动检测Ollama中已部署的所有模型
- **身份分配**：为每个AI随机分配人类姓名和基础背景设定
- **游戏规则说明**：向每个AI私下发送游戏规则和角色设定

#### 1.2 对话轮次管理
- **发言顺序**：每轮随机打乱发言顺序
- **发言时间限制**：设置合理的响应时间上限
- **话题引导**：提供开放性话题或情境促进对话
- **对话记录**：完整记录所有对话内容和时间戳

#### 1.3 投票系统
- **投票机制**：每轮对话结束后进行实名投票
- **投票理由**：要求AI说明投票原因（可选）
- **平票处理**：制定平票时的解决方案
- **淘汰公布**：公开宣布被淘汰者及投票结果

#### 1.4 游戏结束条件
- **最终获胜者**：剩余2个AI或达到预设轮次上限
- **游戏总结**：生成完整的游戏报告和行为分析

### 2. AI角色管理

#### 2.1 身份生成器
- **姓名库**：预设多样化的人类姓名
- **背景故事**：为每个AI生成简单的个人背景
- **性格特征**：随机分配性格标签（友善、谨慎、激进等）
- **记忆一致性**：确保AI在游戏过程中保持角色一致性

#### 2.2 提示词工程
- **角色扮演提示**：强调必须伪装成人类
- **行为指导**：引导AI展现人类化的交流方式
- **策略暗示**：暗示生存竞争的重要性
- **禁止事项**：明确禁止透露AI身份的行为

### 3. 用户界面需求

#### 3.1 实时聊天显示
- **多窗口布局**：清晰显示当前发言者和历史对话
- **参与者列表**：显示所有在场AI及其状态
- **轮次进度**：显示当前轮次和剩余参与者数量
- **投票状态**：实时显示投票进度

#### 3.2 控制面板
- **游戏控制**：开始、暂停、重置游戏
- **参数调整**：修改轮次时间、话题设置等
- **日志查看**：查看详细的系统日志和AI响应
- **数据导出**：导出完整的游戏数据用于分析

### 4. 数据分析功能

#### 4.1 行为统计
- **发言分析**：统计每个AI的发言频率、长度、情绪
- **投票模式**：分析投票目标的选择模式
- **联盟形成**：识别AI之间的互动模式
- **生存策略**：总结不同模型的生存策略

#### 4.2 模型比较
- **性能排名**：基于生存轮次对模型进行排名
- **策略差异**：对比不同模型的行为特征
- **适应能力**：评估模型在压力下的表现
- **社交技巧**：评估模型的人类化表现程度

## 技术需求

### 1. 系统架构

#### 1.1 后端架构
- **语言选择**：Python（推荐）或Node.js
- **框架**：FastAPI + WebSocket（Python）或Express + Socket.io（Node.js）
- **数据库**：SQLite（轻量级）或PostgreSQL（生产环境）
- **消息队列**：Redis（可选，用于大规模部署）

#### 1.2 前端架构
- **技术栈**：React + TypeScript + WebSocket
- **UI框架**：Material-UI 或 Ant Design
- **状态管理**：Redux Toolkit 或 Zustand
- **实时通信**：WebSocket 连接管理

### 2. Ollama集成

#### 2.1 API接口
- **模型发现**：调用Ollama API获取可用模型列表
- **对话接口**：集成Ollama的chat API
- **流式响应**：支持实时流式对话响应
- **错误处理**：处理API调用失败和超时情况

#### 2.2 性能优化
- **并发控制**：管理多个AI同时对话的资源使用
- **缓存机制**：缓存常用的AI响应以提高性能
- **负载均衡**：在多个Ollama实例间分配请求

### 3. 数据存储

#### 3.1 数据模型
```sql
-- 游戏会话
games(id, start_time, end_time, status, settings)

-- AI参与者
participants(id, game_id, model_name, human_name, background, status)

-- 对话轮次
rounds(id, game_id, round_number, start_time, end_time)

-- 对话消息
messages(id, round_id, participant_id, content, timestamp, type)

-- 投票记录
votes(id, round_id, voter_id, target_id, reason, timestamp)

-- 淘汰记录
eliminations(id, game_id, participant_id, round_number, vote_count)
```

#### 3.2 数据分析
- **时间序列数据**：记录完整的时间线数据
- **关系数据**：存储AI之间的互动关系
- **统计指标**：预计算的统计数据用于快速查询

## 实现计划

### Phase 1: 基础框架（1-2周）
1. **项目搭建**：创建基本的前后端项目结构
2. **Ollama集成**：实现基本的Ollama API调用
3. **简单UI**：创建基础的聊天界面
4. **数据模型**：设计和创建数据库表结构

### Phase 2: 核心功能（2-3周）
1. **游戏引擎**：实现轮次管理和状态控制
2. **AI角色系统**：实现身份分配和提示词管理
3. **投票系统**：实现投票机制和淘汰逻辑
4. **实时通信**：完善WebSocket通信和UI更新

### Phase 3: 高级功能（1-2周）
1. **数据分析**：实现行为统计和模型比较
2. **UI优化**：完善用户界面和用户体验
3. **配置管理**：实现游戏参数的灵活配置
4. **错误处理**：完善异常处理和恢复机制

### Phase 4: 测试和优化（1周）
1. **系统测试**：全面测试各种场景和边界情况
2. **性能优化**：优化AI响应速度和系统资源使用
3. **文档完善**：编写用户手册和部署文档
4. **部署准备**：准备生产环境部署方案

## 技术挑战与解决方案

### 1. AI一致性维护
**挑战**：确保AI在整个游戏过程中保持角色一致性
**解决方案**：
- 实现上下文记忆管理
- 定期重申角色设定
- 监控AI回复的一致性

### 2. 自然对话引导
**挑战**：让AI产生自然、有趣的对话内容
**解决方案**：
- 设计多样化的话题库
- 实现情境模拟系统
- 使用高质量的提示词模板

### 3. 公平性保证
**挑战**：确保不同AI模型有相对公平的竞争环境
**解决方案**：
- 标准化提示词格式
- 实现响应时间均衡
- 提供相同的信息访问权限

### 4. 性能优化
**挑战**：多个AI同时运行可能导致性能问题
**解决方案**：
- 实现异步处理架构
- 使用连接池管理
- 监控和限制资源使用

## 扩展功能构想

### 短期扩展
- **主题模式**：不同的游戏主题和背景设定
- **技能系统**：为AI分配特殊能力或限制
- **观众模式**：允许外部观察者观看游戏
- **回放系统**：支持游戏过程的回放和分析

### 长期扩展
- **锦标赛模式**：多场游戏的积分制比赛
- **AI训练**：基于游戏结果训练专用的社交AI
- **多人参与**：允许真实用户参与游戏
- **移动端支持**：开发移动应用程序

## 成功指标

### 技术指标
- **系统稳定性**：99%以上的正常运行时间
- **响应速度**：AI响应时间<30秒
- **并发支持**：支持至少10个AI同时参与
- **数据完整性**：100%的对话和投票数据记录

### 体验指标
- **对话质量**：AI成功伪装人类的比例>80%
- **游戏完成率**：游戏能够正常完成的比例>95%
- **用户满意度**：观察者认为游戏有趣的比例>85%
- **数据价值**：产生有意义的AI行为分析报告

## 风险评估

### 技术风险
- **Ollama依赖**：Ollama服务的稳定性和可用性
- **模型限制**：某些AI模型可能不适合角色扮演
- **资源消耗**：多AI并发可能导致系统资源紧张

### 内容风险
- **不当言论**：AI可能产生不合适的对话内容
- **模式识别**：AI可能学会识别其他AI
- **游戏平衡**：某些模型可能具有不公平的优势

### 解决措施
- **内容过滤**：实现实时内容审核机制
- **监控告警**：建立异常行为检测系统
- **人工干预**：保留必要的人工干预能力
- **版本控制**：支持快速回滚和修复

---

*本文档将随着项目进展持续更新和完善* 